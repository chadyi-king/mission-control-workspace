# Render.com Configuration
# Deploy this to Render for 24/7 background processing

services:
  # Background Worker - Always running, listens to Redis
  - type: worker
    name: helios-background-worker
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: python3 render_worker.py
    envVars:
      - key: UPSTASH_REDIS_URL
        sync: false   # set manually in Render dashboard (same as REDIS_URL)
      - key: HELIOS_API_URL
        sync: false   # set to the helios-api public URL after first deploy
    plan: free

  # Cron Job - Runs every minute
  - type: cron
    name: helios-health-check
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: python3 render_cron.py
    schedule: "*/1 * * * *"  # Every minute
    plan: free

  # Web Service - Helios FastAPI (live websocket + REST for dashboard)
  - type: web
    name: helios-api
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn helios.service:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /api/health
    plan: free
    envVars:
      - key: REDIS_URL
        sync: false   # set manually (same Upstash URL as UPSTASH_REDIS_URL)
      - key: UPSTASH_REDIS_URL
        sync: false   # alias used by worker and chad bridge
      - key: CORS_ALLOWED_ORIGINS
        value: https://mission-control-dashboard-hf0r.onrender.com
