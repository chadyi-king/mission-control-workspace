# Render.com Configuration
# Deploy this to Render for 24/7 background processing

services:
  # Background Worker - Always running, listens to Redis
  - type: worker
    name: helios-background-worker
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: python3 render_worker.py
    envVars:
      - key: UPSTASH_REDIS_REST_URL
        sync: false   # https://national-gar-36005.upstash.io
      - key: UPSTASH_REDIS_REST_TOKEN
        sync: false   # your Upstash REST token
      - key: HELIOS_API_URL
        sync: false   # set to helios-api public URL after first deploy
    plan: free

  # Cron Job - Runs every minute
  - type: cron
    name: helios-health-check
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: python3 render_cron.py
    schedule: "*/1 * * * *"  # Every minute
    plan: free

  # Web Service - Helios FastAPI (live websocket + REST for dashboard)
  - type: web
    name: helios-api
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn helios.service:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /api/health
    plan: free
    envVars:
      - key: UPSTASH_REDIS_REST_URL
        sync: false   # https://national-gar-36005.upstash.io
      - key: UPSTASH_REDIS_REST_TOKEN
        sync: false   # your Upstash REST token
      - key: CORS_ALLOWED_ORIGINS
        value: https://red-sun-mission-control.onrender.com,https://mission-control-dashboard-hf0r.onrender.com
